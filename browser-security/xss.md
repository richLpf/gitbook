## 一、前言

上一篇文章写到，由于浏览器同源策略，导致页面无法引用第三方资源，无法请求不同源下面的域名，所以浏览器出让了一些安全策略，通过CSP安全策略来保证浏览器可以安全的加载第三方资源，通过CORS允许浏览器跨域请求。但是如果没有很好的遵守这些策略，就会给黑客机会攻击我们的站点。常见的攻击方式包括：`XSS攻击`，`CSRF攻击`、`Sql注入攻击`等。

## 二、XSS攻击

### 1、什么是XSS攻击

XSS攻击（跨站脚本攻击），黑客通过网站的漏洞，将恶意脚本插入Html、Dom页面，当用户打开站点时，由于恶意脚本和站点代码拥有同样的执行权限，恶意脚本就有可能篡改站点，窃取用户信息发送到第三方服务器。

恶意代码一般会做下面这些攻击：

- 获取用户Cookies
- 修改用户DOM，伪造登录页面
- 生成浮窗广告
- 监听用户输入

### 2、XSS攻击的分类

XSS攻击常被分为三类：存储型攻击、反射型攻击、基于DOM的XSS攻击，前两种一般要经过服务器，所以后端研发更需要注意，而最后一种没有经过服务器，是需要前端注意避免的。

#### 1）存储型攻击

一个真实的案例就是：2015年乌云网爆出来的，喜玛拉雅站点，编辑上传专辑名称，未对录入表单进行过滤，黑客可以上传恶意脚本到服务器。当其他用户点击这张专辑的时候，就执行了恶意脚本，恶意脚本获取用户的Cookies信息，上传到黑客的服务器，然后就可以登录用户的站点。

第一步：输入恶意脚本到站点，没有过滤，所以可以上传到服务器

![image-20211118211502151](/Users/user/Library/Application Support/typora-user-images/image-20211118211502151.png)

第二步：当用户点击该专辑后，执行了恶意脚本，后端代码没有禁止第三方站点发出的请求，所以黑客就获取了用户的Cookies，接着就可以访问用户的站点或者调用站点的API

![image-20211118211549365](/Users/user/Library/Application Support/typora-user-images/image-20211118211549365.png)

![image-20211118211617355](/Users/user/Library/Application Support/typora-user-images/image-20211118211617355.png)

#### 2）反射型攻击

反射型XSS攻击的常见模式是，黑客发现了网站存在将url的参数直接在页面上显示，并且没有过滤的情况，于是黑客就构造带有恶意脚本的链接，诱导用户点击，当用户点击了链接，就将恶意代码注入到了页面并执行，从而获取用户信息等。



#### 3）基于DOM的XSS攻击

该攻击可以是一些流氓软件或攻击路由器，在http请求返回的过程中，在返回的数据中插入了恶意代码，前端站点如果没有过滤，就可能出现执行恶意代码的情况。



### 3、常见案例

后端通过抓取邮件内容，生成html，给到前端展示。由于邮件中可能存在一些非法标签，浏览器在解析中无法识别，就导致浏览器crash，常常使用插件或者js过滤，转译等。



##  三、防止XSS攻击的办法

阻止XSS攻击，要先知道XSS攻击，一般分为两个步骤。

第一步：黑客找到站点的漏洞，想站点插入恶意脚本。

第二步：读取站点的信息，发送到第三方服务器。

### 1、过滤关键字

对于存储型恶意脚本，需要后端开发在入库的时候进行过滤



### 1、前端框架和组件的使用

目前对于前端的大部分组件（富文本组件）和常见的Vue、React框架都对展示的数据，只会做文本的展示。

对于有可能嵌入恶意代码的部分也贴心的增加了提示：

如在Vue中：

```vue
<div v-html="html"></div>
```

在React中：

```react
<div dangerouslySetInnerHTML = {{__html:<div><script src="http://xxs.js"></script></div>}} ></div>
```

这些可能导致XSS攻击的地方，框架都给了显著的提示，所以在页面显示这些不可控的内容前要进行过滤。

### 


